@baseUrl = http://localhost:8080

# === 공통 변수 ===
@classDate = 2026-03-03
@period = 1
@courseId = 1001
@academicYearId = 1001
@scopeValue = 2026-03
@attendanceId = 4001
@correctionRequestId =
@presentCodeId = 1
@lateCodeId = 2
@enrollmentId1 = 3001
@enrollmentId2 = 3002

# === 교사 계정 ===
@teacherEmail = teacher1@schoolmate.local
@teacherPassword = Passw0rd!
@teacherName = Teacher One
@teacherBirthDate = 1990-01-01
@teacherAuthCode = 90-01-01
@teacherRole = TEACHER
@teacherUserId = 1001
@teacherAccessToken = eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ0ZWFjaGVyMUBzY2hvb2xtYXRlLnRlc3QiLCJpYXQiOjE3NjgyNjIzNDQsImV4cCI6MTc2ODI2NDE0NCwiYXV0aCI6IlRFQUNIRVIiLCJzdGF0dXMiOiJBQ1RJVkUifQ.mtKd5fc0WWGVVQje9MebzoPHsGSIczhvj5VhHBfDLA0CF-jcA-y30vTHtdYq8JwZjYY6eoL7OQgz_ampc0W86g

# === 관리자 계정 ===
@adminEmail = admin1@schoolmate.local
@adminPassword = Passw0rd!
@adminName = Admin One
@adminBirthDate = 1985-03-03
@adminAuthCode = 85-03-03
@adminRole = ADMIN
@adminUserId = 9001
@adminAccessToken = eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ0ZWFjaGVyMUBzY2hvb2xtYXRlLnRlc3QiLCJpYXQiOjE3NjgyMzIxNTYsImV4cCI6MTc2ODIzMzk1NiwiYXV0aCI6IlRFQUNIRVIiLCJzdGF0dXMiOiJBQ1RJVkUifQ.Oh1-A1kRP8UFnEnjefDkqjuldwq5kiRWctLPlEqdkke6DZs7gyjfj7P4F4CGxEIf4gJabaBQWgo_XtClmJauYg
@refreshToken = eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbkBzY2hvb2xtYXRlLnRlc3QiLCJpYXQiOjE3NjgyMTk2NDMsImV4cCI6MTc2ODgyNDQ0M30.15JgSEv-ZuSvuvGVt2lih7_fHV6Fi6VYD3p4ncN5vx9wnNu6mSyMwGb0XlYDFkM-OS1curztNUoLqjDJwQSljQ

# === 학생 계정 ===
@studentEmail = student1@schoolmate.local
@studentPassword = Passw0rd!
@studentName = Student One
@studentBirthDate = 2008-05-05
@studentAuthCode = 08-05-05
@studentRole = STUDENT
@studentUserId = 2001
@studentAccessToken =

############################################################
# 사전 준비
# - courseId, academicYearId, enrollmentId, attendanceCodeId는 DB에 존재해야 함
# - 담임 테스트는 교사 상세(TeacherDetail)에 homeroom 정보가 있어야 함
############################################################

### 교사 회원가입 (샘플 데이터 사용 시 생략)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "{{teacherEmail}}",
  "password": "{{teacherPassword}}",
  "name": "{{teacherName}}",
  "birthDate": "{{teacherBirthDate}}",
  "role": "{{teacherRole}}"
}
> {% client.global.set("teacherUserId", response.body.data); %}

### 교사 계정 활성화 (샘플 데이터 사용 시 생략)
POST {{baseUrl}}/api/auth/activate
Content-Type: application/json

{
  "email": "{{teacherEmail}}",
  "name": "{{teacherName}}",
  "birthDate": "{{teacherBirthDate}}",
  "authCode": "{{teacherAuthCode}}",
  "newPassword": "{{teacherPassword}}"
}

### 교사 로그인
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{teacherEmail}}",
  "password": "{{teacherPassword}}"
}
> {% client.global.set("teacherAccessToken", response.body.data.accessToken); %}
> {% client.global.set("refreshToken", response.body.data.refreshToken); %}

### 관리자 회원가입 (샘플 데이터 사용 시 생략)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}",
  "name": "{{adminName}}",
  "birthDate": "{{adminBirthDate}}",
  "role": "{{adminRole}}"
}
> {% client.global.set("adminUserId", response.body.data); %}

### 관리자 계정 활성화 (샘플 데이터 사용 시 생략)
POST {{baseUrl}}/api/auth/activate
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "name": "{{adminName}}",
  "birthDate": "{{adminBirthDate}}",
  "authCode": "{{adminAuthCode}}",
  "newPassword": "{{adminPassword}}"
}

### 관리자 로그인
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}
> {% client.global.set("adminAccessToken", response.body.data.accessToken); %}
> {% client.global.set("refreshToken", response.body.data.refreshToken); %}

### 학생 회원가입 (샘플 데이터 사용 시 생략)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "{{studentEmail}}",
  "password": "{{studentPassword}}",
  "name": "{{studentName}}",
  "birthDate": "{{studentBirthDate}}",
  "role": "{{studentRole}}"
}
> {% client.global.set("studentUserId", response.body.data); %}

### 학생 계정 활성화 (샘플 데이터 사용 시 생략)
POST {{baseUrl}}/api/auth/activate
Content-Type: application/json

{
  "email": "{{studentEmail}}",
  "name": "{{studentName}}",
  "birthDate": "{{studentBirthDate}}",
  "authCode": "{{studentAuthCode}}",
  "newPassword": "{{studentPassword}}"
}

### 학생 로그인
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{studentEmail}}",
  "password": "{{studentPassword}}"
}
> {% client.global.set("studentAccessToken", response.body.data.accessToken); %}

############################################################
# 출결 기능 테스트
############################################################

### 출결 코드 목록 조회 (활성 코드)
GET {{baseUrl}}/api/attendance/codes?activeOnly=true
Authorization: Bearer {{teacherAccessToken}}

### 출결 자동 생성
POST {{baseUrl}}/api/attendance/generate
Authorization: Bearer {{teacherAccessToken}}
Content-Type: application/json

{
  "courseId": {{courseId}},
  "classDate": "{{classDate}}",
  "period": {{period}},
  "userId": {{teacherUserId}}
}

### 출결 저장
POST {{baseUrl}}/api/attendance/save
Authorization: Bearer {{teacherAccessToken}}
Content-Type: application/json

{
  "courseId": {{courseId}},
  "classDate": "{{classDate}}",
  "period": {{period}},
  "userId": {{teacherUserId}},
  "items": [
    { "enrollmentId": {{enrollmentId1}}, "attendanceCodeId": {{lateCodeId}}, "reason": "지각" },
    { "enrollmentId": {{enrollmentId2}}, "attendanceCodeId": {{presentCodeId}}, "reason": null }
  ]
}

### 출결 확정 (담임 테스트 시, homeroom 정보가 있는 교사로 요청)
POST {{baseUrl}}/api/attendance/confirm
Authorization: Bearer {{teacherAccessToken}}
Content-Type: application/json

{
  "courseId": {{courseId}},
  "classDate": "{{classDate}}",
  "period": {{period}},
  "userId": {{teacherUserId}}
}

### 출결 마감 (관리자)
POST {{baseUrl}}/api/v1/attendance/closures/
Authorization: Bearer {{adminAccessToken}}
Content-Type: application/json

{
  "academicYearId": {{academicYearId}},
  "scopeType": "MONTH",
  "scopeValue": "{{scopeValue}}",
  "courseId": {{courseId}},
  "userId": {{adminUserId}}
}

### 출결 정정 요청 (확정/마감 후)
POST {{baseUrl}}/api/attendance/corrections
Authorization: Bearer {{teacherAccessToken}}
Content-Type: application/json

{
  "attendanceId": {{attendanceId}},
  "requestedAttendanceCodeId": {{presentCodeId}},
  "requestReason": "지각이 아니라 출석",
  "requestedBy": {{teacherUserId}}
}

### 출결 정정 승인 (관리자)
POST {{baseUrl}}/api/attendance/corrections/decide
Authorization: Bearer {{adminAccessToken}}
Content-Type: application/json

{
  "requestId": {{correctionRequestId}},
  "approved": true,
  "adminId": {{adminUserId}}
}

### 출결 조회 (목록)
GET {{baseUrl}}/api/attendance?fromDate={{classDate}}&toDate={{classDate}}&courseId={{courseId}}&period={{period}}
Authorization: Bearer {{teacherAccessToken}}

### 출결 조회 (단건)
GET {{baseUrl}}/api/attendance/{{attendanceId}}
Authorization: Bearer {{teacherAccessToken}}
