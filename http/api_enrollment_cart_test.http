### 전역 변수 설정
@host = http://localhost:8000
@contentType = application/json

# ==========================================
# 1. 관리자 권한 작업 (기초 데이터 세팅)
# ==========================================

### 1-1. 관리자 로그인
POST {{host}}/auth/login
Content-Type: {{contentType}}

{
  "email": "admin@test.com",
  "password": "admin1234"
}

> {%
    client.global.set("admin_token", response.body.data.accessToken);
%}

### 1-2. 과목(Subject) 생성
POST {{host}}/subjects
Authorization: Bearer {{admin_token}}
Content-Type: {{contentType}}

{
    "name": "컴퓨터공학개론"
}

> {%
    client.global.set("subject_id", response.body.data);
%}

### 1-3. 학년도/학기 생성
POST {{host}}/schedule/years
Authorization: Bearer {{admin_token}}
Content-Type: {{contentType}}

{
  "year": 2026,
  "semester": 1,
  "startDate": "2026-03-01",
  "endDate": "2026-06-30"
}

> {%
    client.global.set("academic_year_id", response.body.data);
%}

# ==========================================
# 2. 교사 등록 및 강좌 개설
# ==========================================

### 2-1. 교사 회원가입 (관리자가 등록)
POST {{host}}/user/register
Authorization: Bearer {{admin_token}}
Content-Type: {{contentType}}

{
  "email": "teacher_test@test.com",
  "password": "password1234!",
  "name": "박교사",
  "role": "TEACHER",
  "birthDate": "1985-05-10",
  "teacherDetail": {
    "subjectId": {{subject_id}}
  }
}

### 2-2. 교사 계정 활성화
POST {{host}}/auth/activate
Content-Type: {{contentType}}

{
  "email": "teacher_test@test.com",
  "name": "박교사",
  "birthDate": "1985-05-10",
  "authCode": "850510",
  "newPassword": "password1234!"
}

### 2-3. 교사 로그인
POST {{host}}/auth/login
Content-Type: {{contentType}}

{
  "email": "teacher_test@test.com",
  "password": "password1234!"
}

> {%
    client.global.set("teacher_token", response.body.data.accessToken);
    client.global.set("teacher_id", response.body.data.userId);
%}

### 2-3-1. 교사 ID 조회 (토큰을 사용하여 내 정보 조회)
GET {{host}}/user/me
Authorization: Bearer {{teacher_token}}

> {%
    // 응답 바디의 구조에 따라 userId 또는 id를 추출
    // 예: response.body.data.userId
    client.global.set("teacher_id", response.body.data.userId);
%}

### 2-4. 강좌 개설 신청 (교사)
POST {{host}}/courses
Authorization: Bearer {{teacher_token}}
Content-Type: {{contentType}}

{
  "name": "자바 마스터 클래스",
  "courseType": "MANDATORY",
  "maxCapacity": 2,
  "tuition": 200000,
  "subjectId": {{subject_id}},
  "academicYearId": {{academic_year_id}},
  "teacherDetailId": {{teacher_id}},
  "timeSlots": [
    {
      "dayOfWeek": "MONDAY",
      "period": 1,
      "classroom": "IT관 101호"
    }
  ]
}

> {%
    // 생성된 강좌 ID를 가져오기 위해 목록 조회 필요 (또는 응답에 ID가 있다면 바로 사용)
%}

### 2-5. 강좌 승인 (관리자)
# 강좌 ID가 1번이라고 가정 (실제 응답값에 따라 수정)
@course_id = 1

POST {{host}}/courses/{{course_id}}/approve
Authorization: Bearer {{admin_token}}


# ==========================================
# 3. 학생 등록 및 수강 신청/장바구니
# ==========================================

### 3-1. 학생 회원가입 (관리자가 등록)
POST {{host}}/user/register
Authorization: Bearer {{admin_token}}
Content-Type: {{contentType}}

{
  "email": "student_test@test.com",
  "password": "password1234!",
  "name": "최학생",
  "role": "STUDENT",
  "birthDate": "2006-01-01",
  "studentDetail": {
    "grade": 1,
    "classNo": "A",
    "studentNo": 10
  }
}

### 3-2. 학생 계정 활성화
POST {{host}}/auth/activate
Content-Type: {{contentType}}

{
  "email": "student_test@test.com",
  "name": "최학생",
  "birthDate": "2006-01-01",
  "authCode": "060101",
  "newPassword": "password1234!"
}

### 3-3. 학생 로그인
POST {{host}}/auth/login
Content-Type: {{contentType}}

{
  "email": "student_test@test.com",
  "password": "password1234!"
}

> {%
    client.global.set("student_token", response.body.data.accessToken);
%}

### 0-4-1. 학생 ID 조회 (fallback)
GET http://localhost:8000/user/me
Authorization: Bearer {{student_token}}

> {%
    client.global.set("student_id", response.body.data.userId);
%}

### 3-4. 장바구니 담기
POST http://localhost:8000/carts
Authorization: Bearer {{student_token}}
Content-Type: {{contentType}}

{
  "courseId": {{course_id}}
}

### 3-5. 장바구니 목록 조회
GET {{host}}/carts
Authorization: Bearer {{student_token}}

### 3-6. 장바구니 일괄 수강 신청
POST {{host}}/enrollments/bulk
Authorization: Bearer {{student_token}}

### 3-7. 수강 내역 확인
GET {{host}}/enrollments/history
Authorization: Bearer {{student_token}}

### 3-7. 시간표 확인
GET {{host}}/enrollments/timetable
Authorization: Bearer {{student_token}}

### 3-8. 수강 취소 테스트
# 조회 결과에서 enrollment_id 확인 후 입력
@enrollment_id = 1
DELETE {{host}}/  enrollments/{{enrollment_id}}
Authorization: Bearer {{student_token}}